JS.Test=new JS.Module('Test',{extend:{Unit:new JS.Module({extend:{AssertionFailedError:new JS.Class(Error,{initialize:function(a){this.message=a.toString()}})}}),asyncTimeout:10,showStack:true,filter:function(a,b){return this.Unit.AutoRunner.filter(a,b)}}});JS.Test.Unit.extend({Util:new JS.Module({extend:{Observable:new JS.Module({extend:{NOTHING:{}},addListener:function(a,b,c){if(b===undefined)throw new Error('No callback was passed as a listener');this.channels()[a]=this.channels()[a]||[];this.channels()[a].push([b,c]);return b},removeListener:function(a,b,c){var d=this.channels()[a];if(!d)return;var f=d.length;while(f--){if(d[f][0]===b){d.splice(f,1);return b}}return null},notifyListeners:function(a,b){var b=JS.array(arguments),a=b.shift(),c=this.channels()[a];if(!c)return 0;for(var d=0,f=c.length;d<f;d++)c[d][0].apply(c[d][1]||null,b);return c.length},channels:function(){return this.__channels__=this.__channels__||[]}})}})});JS.Test.Unit.extend({Assertions:new JS.Module({assertBlock:function(a,b,c){if(typeof a==='function'){c=b;b=a;a=null}this.__wrapAssertion__(function(){if(!b.call(c||null)){a=this.buildMessage(a||'assertBlock failed');throw new JS.Test.Unit.AssertionFailedError(a);}})},flunk:function(a){this.assertBlock(this.buildMessage(a||'Flunked'),function(){return false})},assert:function(a,b){this.__wrapAssertion__(function(){this.assertBlock(this.buildMessage(b,'<?> is not true',a),function(){return a})})},assertEqual:function(a,b,c){var d=this.buildMessage(c,'<?> expected but was\n<?>',a,b);this.assertBlock(d,function(){return JS.Enumerable.areEqual(a,b)})},assertNotEqual:function(a,b,c){var d=this.buildMessage(c,'<?> expected not to be equal to\n<?>',a,b);this.assertBlock(d,function(){return!JS.Enumerable.areEqual(a,b)})},assertNull:function(a,b){this.assertEqual(null,a,b)},assertNotNull:function(a,b){var c=this.buildMessage(b,'<?> expected not to be null',a);this.assertBlock(c,function(){return a!==null})},assertKindOf:function(c,d,f){this.__wrapAssertion__(function(){var a=(!d||typeof c==='string')?typeof d:(d.klass||d.constructor);var b=this.buildMessage(f,'<?> expected to be an instance of\n<?> but was\n<?>',d,c,a);this.assertBlock(b,function(){return JS.isType(d,c)})})},assertRespondTo:function(c,d,f){this.__wrapAssertion__(function(){var a=this.buildMessage('','<?>\ngiven as the method name argument to #assertRespondTo must be a String',d);this.assertBlock(a,function(){return typeof d==='string'});var b=c?c.constructor:typeof c;a=this.buildMessage(f,'<?>\nof type <?>\nexpected to respond to <?>',c,b,d);this.assertBlock(a,function(){return c&&c[d]!==undefined})})},assertMatch:function(b,c,d){this.__wrapAssertion__(function(){var a=this.buildMessage(d,'<?> expected to match\n<?>',c,b);this.assertBlock(a,function(){return JS.match(b,c)})})},assertNoMatch:function(b,c,d){this.__wrapAssertion__(function(){var a=this.buildMessage(d,'<?> expected not to match\n<?>',c,b);this.assertBlock(a,function(){return(typeof b.test==='function')?!b.test(c):!b.match(c)})})},assertSame:function(a,b,c){var d=this.buildMessage(c,'<?> expected to be the same as\n<?>',a,b);this.assertBlock(d,function(){return b===a})},assertNotSame:function(a,b,c){var d=this.buildMessage(c,'<?> expected not to be the same as\n<?>',a,b);this.assertBlock(d,function(){return b!==a})},assertInDelta:function(b,c,d,f){this.__wrapAssertion__(function(){this.assertKindOf('number',b);this.assertKindOf('number',c);this.assertKindOf('number',d);this.assert(d>=0,'The delta should not be negative');var a=this.buildMessage(f,'<?> and\n<?> expected to be within\n<?> of each other',b,c,d);this.assertBlock(a,function(){return Math.abs(b-c)<=d})})},assertSend:function(b,c){this.__wrapAssertion__(function(){this.assertKindOf(Array,b,'assertSend requires an array of send information');this.assert(b.length>=2,'assertSend requires at least a receiver and a message name');var a=this.buildMessage(c,'<?> expected to respond to\n<?(?)> with a true value',b[0],JS.Test.Unit.AssertionMessage.literal(b[1]),b.slice(2));this.assertBlock(a,function(){return b[0][b[1]].apply(b[0],b.slice(2))})})},__processExceptionArgs__:function(a){var a=JS.array(a),b=(typeof a[a.length-1]==='function')?null:a.pop(),c=a.pop(),d=JS.isType(a[a.length-1],'string')?a.pop():'',f=new JS.Enumerable.Collection(a);return[a,f,d,c,b]},assertThrow:function(){var d=this.__processExceptionArgs__(arguments),f=d[0],g=d[1],h=d[2],i=d[3],j=d[4];this.__wrapAssertion__(function(){var b=this.buildMessage(h,'<?> exception expected but none was thrown',f),c;this.assertBlock(b,function(){try{i.call(j)}catch(e){c=e;return true}return false});b=this.buildMessage(h,'<?> exception expected but was\n?',f,c);this.assertBlock(b,function(){return g.any(function(a){return JS.isType(c,a)||(c.name&&c.name===a.name)})})})},assertThrows:function(){return this.assertThrow.apply(this,arguments)},assertNothingThrown:function(){var a=this.__processExceptionArgs__(arguments),b=a[0],c=a[1],d=a[2],f=a[3],g=a[4];this.__wrapAssertion__(function(){try{f.call(g)}catch(e){if((b.length===0&&!JS.isType(e,JS.Test.Unit.AssertionFailedError))||c.any(function(type){return JS.isType(e,type)}))this.assertBlock(this.buildMessage(d,'Exception thrown:\n?',e),function(){return false});else throw e;}})},buildMessage:function(){var a=JS.array(arguments),b=a.shift(),c=a.shift();return new JS.Test.Unit.AssertionMessage(b,c,a)},__wrapAssertion__:function(a){if(this.__assertionWrapped__===undefined)this.__assertionWrapped__=false;if(!this.__assertionWrapped__){this.__assertionWrapped__=true;try{this.addAssertion();return a.call(this)}finally{this.__assertionWrapped__=false}}else{return a.call(this)}},addAssertion:function(){}})});JS.Test.Unit.extend({AssertionMessage:new JS.Class({extend:{Literal:new JS.Class({initialize:function(a){this._1i=a;this.toString=this.inspect},inspect:function(){return this._1i.toString()}}),literal:function(a){return new this.Literal(a)},Template:new JS.Class({extend:{create:function(a){var b=a?a.match(/\(\?\)|(?=[^\\])\?|(?:(?!\(\?\))(?:\\\?|[^\?]))+/g):[];return new this(b)}},initialize:function(b){this._W=new JS.Enumerable.Collection(b);this.count=this._W.findAll(function(a){return a==='?'||a==='(?)'}).length},result:function(b){if(b.length!==this.count)throw'The number of parameters does not match the number of substitutions';var c=JS.array(b);return this._W.collect(function(a){if(a==='(?)')return c.shift().replace(/^\[/,'(').replace(/\]$/,')');if(a==='?')return c.shift();return a.replace(/\\\?/g,'?')}).join('')}})},initialize:function(a,b,c){this._X=a;this._1j=b;this._1k=new JS.Enumerable.Collection(c)},template:function(){return this._1l=this._1l||this.klass.Template.create(this._1j)},toString:function(){var b=[],c,d;if(this._X)b.push(this._X);d=this.template().result(this._1k.collect(function(a){return JS.Console.convert(a)},this));if(d!=='')b.push(d);return b.join('\n')}})});JS.Test.Unit.extend({Failure:new JS.Class({extend:{SINGLE_CHARACTER:'F'},initialize:function(a,b){this._l=a;this._Y=b},singleCharacterDisplay:function(){return this.klass.SINGLE_CHARACTER},shortDisplay:function(){return this._l+': '+this._Y.split('\n')[0]},longDisplay:function(){return'Failure:\n'+this._l+':\n'+this._Y},toString:function(){return this.longDisplay()}})});JS.Test.Unit.extend({Error:new JS.Class({extend:{SINGLE_CHARACTER:'E'},initialize:function(a,b){this._l=a;this._f=b},singleCharacterDisplay:function(){return this.klass.SINGLE_CHARACTER},message:function(){return this._f.name+': '+this._f.message},shortDisplay:function(){return this._l+': '+this.message().split('\n')[0]},longDisplay:function(){var a='Error:\n'+this._l+':\n',b=JS.Console.filterBacktrace(this._f.stack||'');if(b&&JS.Test.showStack)a+=b;else a+=this.message();return a},toString:function(){return this.longDisplay()}})});JS.Test.Unit.extend({TestResult:new JS.Class({include:JS.Test.Unit.Util.Observable,extend:{CHANGED:'CHANGED',FAULT:'FAULT'},initialize:function(){this._Z=this._10=0;this._a=[];this._m=[]},addRun:function(){this._Z+=1;this.notifyListeners(this.klass.CHANGED,this)},addFailure:function(a){this._a.push(a);this.notifyListeners(this.klass.FAULT,a);this.notifyListeners(this.klass.CHANGED,this)},addError:function(a){this._m.push(a);this.notifyListeners(this.klass.FAULT,a);this.notifyListeners(this.klass.CHANGED,this)},addAssertion:function(){this._10+=1;this.notifyListeners(this.klass.CHANGED,this)},toString:function(){return this.runCount()+' tests, '+this.assertionCount()+' assertions, '+this.failureCount()+' failures, '+this.errorCount()+' errors'},passed:function(){return this._a.length===0&&this._m.length===0},runCount:function(){return this._Z},assertionCount:function(){return this._10},failureCount:function(){return this._a.length},errorCount:function(){return this._m.length}})});JS.Test.Unit.extend({TestSuite:new JS.Class({include:JS.Enumerable,extend:{STARTED:'Test.Unit.TestSuite.STARTED',FINISHED:'Test.Unit.TestSuite.FINISHED',forEach:function(b,c,d,f){var g=false,h=false,i=b.length,j=-1,k=new Date().getTime(),m=this.setTimeout;var l=function(){h=true;var a=new Date().getTime();if(JS.Console.BROWSER&&(a-k)>1000){k=a;g=false;m(n,0)}else if(!g){g=true;while(g)n()}};var n=function(){j+=1;if(j===i){g=false;return d&&d.call(f||null)}h=false;c.call(f||null,b[j],l);if(!h)g=false};l()},setTimeout:(function(){return(typeof setTimeout==='undefined')?undefined:setTimeout})()},initialize:function(a){this._b=a||'Unnamed TestSuite';this._3=[]},forEach:function(a,b,c){this.klass.forEach(this._3,a,b,c)},run:function(c,d,f,g){f.call(g||null,this.klass.STARTED,this._b);this.forEach(function(a,b){a.run(c,b,f,g)},function(){f.call(g||null,this.klass.FINISHED,this._b);d.call(g||null)},this)},push:function(a){this._3.push(a);return this},remove:function(a){var b=this._3.length;while(b--){if(this._3[b]===a)this._3.splice(b,1)}},size:function(){var a=0,b=this._3.length;while(b--){a+=this._3[b].size()}return a},empty:function(){return this._3.length===0},toString:function(){return this._b}})});JS.Test.Unit.extend({TestCase:new JS.Class({include:JS.Test.Unit.Assertions,extend:[JS.Enumerable,{testCases:[],reports:[],handlers:[],clear:function(){this.testCases=[]},inherited:function(a){this.testCases.push(a)},forEach:function(a,b){for(var c=0,d=this.testCases.length;c<d;c++)a.call(b||null,this.testCases[c])},STARTED:'Test.Unit.TestCase.STARTED',FINISHED:'Test.Unit.TestCase.FINISHED',suite:function(b,c,d){var f=new JS.Enumerable.Collection(this.instanceMethods(c)),g=f.select(function(a){return this.filter(a,b)},this).sort(),h=new JS.Test.Unit.TestSuite(this.displayName);for(var i=0,j=g.length;i<j;i++){try{h.push(new this(g[i]))}catch(e){}}if(h.empty()&&d){try{h.push(new this('defaultTest'))}catch(e){}}return h},filter:function(a,b){if(!/^test./.test(a))return false;if(!b||b.length===0)return true;var c=b.length;while(c--){if(a.substr(6,b[c].length)===b[c])return true}return false}}],initialize:function(a){if(typeof this[a]!=='function')throw'invalid_test';this._1=a;this._C=true},run:function(a,b,c,d){c.call(d||null,this.klass.STARTED,this);this._2=a;var f=function(){this.exec('teardown',function(){this.exec(function(){JS.Test.Unit.mocking.verify()},function(){a.addRun();c.call(d||null,this.klass.FINISHED,this);b()})})};this.exec('setup',function(){this.exec(this._1,f)},f)},exec:function(b,c,d){if(!b)return c.call(this);if(!d)d=c;var f=(typeof b==='function')?b.length:this.__eigen__().instanceMethod(b).arity,g=(typeof b==='function')?b:this[b],h=null,i=false,j=false,k=this;if(f===0)return this._11(function(){g.call(this);c.call(this)},this._12(d));var m=function(a){k.exec(function(){i=true;this._p();if(h)JS.ENV.clearTimeout(h);throw a;},c,d)};this._13(m);this._11(function(){g.call(this,function(a){j=true;k._p();if(h)JS.ENV.clearTimeout(h);if(!i)k.exec(a,c,d)})},this._12(d));if(!j&&JS.ENV.setTimeout)h=JS.ENV.setTimeout(function(){k.exec(function(){i=true;this._p();throw new Error('Timed out after waiting '+JS.Test.asyncTimeout+' seconds for test to resume');},c,d)},JS.Test.asyncTimeout*1000)},_13:function(a,b){if(!a)return;this._p(false);if(JS.Console.NODE)process.addListener('uncaughtException',a);else if(JS.Console.BROWSER)window.onerror=a;if(b!==false)this.klass.handlers.push(a);return a},_p:function(a){var b=this.klass.handlers,c=b[b.length-1];if(!c)return;if(JS.Console.NODE)process.removeListener('uncaughtException',c);else if(JS.Console.BROWSER)window.onerror=null;if(a!==false){b.pop();this._13(b[b.length-1],false)}},_12:function(b){return function(a){if(JS.isType(a,JS.Test.Unit.AssertionFailedError))this.addFailure(a.message);else this.addError(a);if(b)b.call(this)}},_11:function(a,b,c){try{a.call(this)}catch(e){if(b)b.call(this,e)}finally{if(c)c.call(this)}},setup:function(a){a()},teardown:function(a){a()},defaultTest:function(){return this.flunk('No tests were specified')},passed:function(){return this._C},size:function(){return 1},addAssertion:function(){this._2.addAssertion()},addFailure:function(a){this._C=false;this._2.addFailure(new JS.Test.Unit.Failure(this.name(),a))},addError:function(a){this._C=false;this._2.addError(new JS.Test.Unit.Error(this.name(),a))},name:function(){var a=this._1.replace(/^test\W*/ig,'');if(a.replace(this.klass.displayName,'')===a)return this._1+'('+this.klass.displayName+')';else return a},toString:function(){return this.name()}})});JS.Test.Unit.extend({UI:new JS.Module({extend:{SILENT:1,PROGRESS_ONLY:2,NORMAL:3,VERBOSE:4,TestRunnerUtilities:new JS.Module({run:function(a,b){return new this(a,b||JS.Test.Unit.UI.NORMAL).start()},getFilter:function(){if(JS.ENV.location&&/\btest=/.test(location.search)){var a=[],b=location.search.match(/\btest=([^&]+)/)[1].split(','),c=b.length;while(c--)a.push(decodeURIComponent(b[c]));return a}else if(typeof process==='object'){return process.argv.slice(2)}else return[]}})}})});JS.Test.Unit.UI.extend({TestRunnerMediator:new JS.Class({extend:{RESET:'Test.Unit.UI.TestRunnerMediator.RESET',STARTED:'Test.Unit.UI.TestRunnerMediator.STARTED',FINISHED:'Test.Unit.UI.TestRunnerMediator.FINISHED'},include:JS.Test.Unit.Util.Observable,initialize:function(a){this._5=a},runSuite:function(){var g=new Date().getTime();this.notifyListeners(this.klass.RESET,this._5.size());var h=this.createResult();this.notifyListeners(this.klass.STARTED,h);var i=JS.bind(function(){h.removeListener(JS.Test.Unit.TestResult.FAULT,k);h.removeListener(JS.Test.Unit.TestResult.CHANGED,j);var a=new Date().getTime(),b=(a-g)/1000,c=true;var d=JS.Test.Unit.TestCase.reports,f=d.length;while(f--){JS.Console.output('');c=c&&d[f].report()}JS.Test.Unit.TestCase.reports=[];this.notifyListeners(this.klass.FINISHED,b,c)},this);var j=h.addListener(JS.Test.Unit.TestResult.CHANGED,function(a){this.notifyListeners(JS.Test.Unit.TestResult.CHANGED,a)},this);var k=h.addListener(JS.Test.Unit.TestResult.FAULT,function(a){this.notifyListeners(JS.Test.Unit.TestResult.FAULT,a)},this);this._5.run(h,i,function(a,b){this.notifyListeners(a,b)},this)},createResult:function(){return new JS.Test.Unit.TestResult()}})});JS.Test.Unit.UI.extend({Console:new JS.Module({extend:{TestRunner:new JS.Class({extend:JS.Test.Unit.UI.TestRunnerUtilities,include:JS.Console,initialize:function(a,b){this._5=(typeof a.suite==='function')?a.suite():a;this._1m=b||JS.Test.Unit.UI.NORMAL;this._D=false;this._n=[]},start:function(){this._E();this._F();return this._G()},_E:function(){this._0=this._H(this._5);var a=this._5.toString();if(JS.isType(this._5,JS.Module))a=this._5.displayName;this.consoleFormat('bold');this._c('Loaded suite '+a)},_H:function(a){return new JS.Test.Unit.UI.TestRunnerMediator(a)},_F:function(){this._0.addListener(JS.Test.Unit.TestResult.FAULT,this.method('_I'));this._0.addListener(JS.Test.Unit.UI.TestRunnerMediator.STARTED,this.method('_J'));this._0.addListener(JS.Test.Unit.UI.TestRunnerMediator.FINISHED,this.method('_K'));this._0.addListener(JS.Test.Unit.TestCase.STARTED,this.method('_L'));this._0.addListener(JS.Test.Unit.TestCase.FINISHED,this.method('_M'))},_G:function(){return this._0.runSuite()},_I:function(a){this._n.push(a);this.consoleFormat('bold','red');this._N(a.singleCharacterDisplay(),JS.Test.Unit.UI.PROGRESS_ONLY);this.reset();this._D=true},_J:function(a){this._2=a;this._q();this.reset();this._c('Started')},_K:function(a,b){for(var c=0,d=this._n.length;c<d;c++){var f=this._n[c].longDisplay(),g=f.split('\n'),h=g.shift(),i=g.shift(),j;this.consoleFormat('bold','red');this._q();this._c('\n'+(c+1)+') '+h);this._c(i);this.reset();while(j=g.shift())this.puts(j)}this.reset();this._q();this._c('Finished in '+a+' seconds');var k=(b&&this._2.passed()),m=k?'green':'red';this.consoleFormat(m);this._c(this._2,JS.Test.Unit.UI.PROGRESS_ONLY);this.reset();this.puts('');var l=k?0:1;if(typeof WScript!=='undefined')WScript.Quit(l);if(typeof process==='object')process.exit(l);if(typeof system==='object'&&system.exit)system.exit(l);if(typeof quit=='function')quit(l)},_L:function(a){this._N(a.name()+': ',JS.Test.Unit.UI.VERBOSE)},_M:function(a){this.consoleFormat('green');if(!this._D)this._N('.',JS.Test.Unit.UI.PROGRESS_ONLY);this.reset();this._q(JS.Test.Unit.UI.VERBOSE);this._D=false},_q:function(a){this._c('',a||JS.Test.Unit.UI.NORMAL)},_c:function(a,b){if(!this._14(b||JS.Test.Unit.UI.NORMAL))return;this.puts(a)},_N:function(a,b){if(!this._14(b||JS.Test.Unit.UI.NORMAL))return;this.print(a)},_14:function(a){return a<=this._1m}})}})});JS.Test.Unit.UI.extend({Browser:new JS.Module({extend:{TestRunner:new JS.Class({extend:JS.Test.Unit.UI.TestRunnerUtilities,initialize:function(a,b){this._5=(typeof a.suite==='function')?a.suite():a;this._n=[];this._6()},_6:function(){return this._1n=this._1n||new this.klass.Display()},start:function(){this._E();this._F();return this._G()},_E:function(){this._0=this._H(this._5)},_H:function(a){return new JS.Test.Unit.UI.TestRunnerMediator(a)},_F:function(){this._0.addListener(JS.Test.Unit.TestResult.CHANGED,this.method('_1o'));this._0.addListener(JS.Test.Unit.TestResult.FAULT,this.method('_I'));this._0.addListener(JS.Test.Unit.UI.TestRunnerMediator.STARTED,this.method('_J'));this._0.addListener(JS.Test.Unit.UI.TestRunnerMediator.FINISHED,this.method('_K'));this._0.addListener(JS.Test.Unit.TestCase.STARTED,this.method('_L'));this._0.addListener(JS.Test.Unit.TestCase.FINISHED,this.method('_M'));if(!window.TestSwarm)return;TestSwarm.serialize=this.method('serialize');this._0.addListener(JS.Test.Unit.TestCase.FINISHED,TestSwarm.heartbeat);this._0.addListener(JS.Test.Unit.UI.TestRunnerMediator.FINISHED,function(){TestSwarm.submit(this._15())},this)},_15:function(){return{fail:this._2.failureCount(),error:this._2.errorCount(),total:this._2.runCount()}},_G:function(){return this._0.runSuite()},_1o:function(){this._6().setTestCount(this._2.runCount());this._6().setAssertionCount(this._2.assertionCount());this._6().setFailureCount(this._2.failureCount());this._6().setErrorCount(this._2.errorCount())},_I:function(a){this._n.push(a);this._16='failed';this._6().addFault(this._1p,a)},_J:function(a){this._2=a},_K:function(a){this._6().printSummary(a);this._17({jstest:this._15()})},_L:function(a){this._1p=a;this._16='passed';this._6().addTestCase(a)},_M:function(a){this._6().finishTestCase(a);this._17({jstest:{test:a.toString(),status:this._16}})},_17:function(a){if(window.console&&window.JSON&&!window.Components)console.log(JSON.stringify(a))},serialize:function(){var a=document.getElementsByTagName('li'),b=a.length;while(b--)JS.DOM.removeClass(a[b],'closed');var a=document.getElementsByTagName('script'),b=a.length;while(b--)a[b].parentNode.removeChild(a[b]);var c=document.getElementsByTagName('html')[0];return'<!doctype html><html>'+c.innerHTML+'</html>'}})}})});JS.Test.Unit.UI.Browser.TestRunner.extend({Display:new JS.Class({extend:{Context:new JS.Class({initialize:function(a,b,c){this._7=b;this._8=a;this._b=c;this._O=[];if(c===undefined){this._P=b;return}this._Q(c)},_Q:function(f){var g=this,h=this._7._P||this._7,i={_3:'Tests',_a:'Failed'};this._r=new JS.DOM.Builder(h).li({className:this._8+' passed'},function(d){d.ul({className:'stats'},function(b){for(var c in i)b.li(function(a){a.span({className:'label'},i[c]+': ');g[c]=a.span({className:'number'},'0')})});if(f){g._s=d.p({className:g._8+'-name'},f);if(g._8==='spec'){g._t=JS.DOM.span({className:'runner'},'Run');g._t.style.background='url("'+JSCLASS_PATH+'assets/bullet_go.png") center center no-repeat';g._s.insertBefore(g._t,g._s.firstChild)}}g._P=d.ul({className:'children'})});if(!/\btest=/.test(window.location.search))JS.DOM.addClass(this._r,'closed');JS.DOM.Event.on(this._s,'click',function(){JS.DOM.toggleClass(this._r,'closed')},this);if(this._t)JS.DOM.Event.on(this._t,'click',this.runTest,this)},child:function(a){return this._O[a]=this._O[a]||new this.klass('spec',this,a)},addTest:function(a){var b=this._O[a]=new this.klass('test',this,a);b.ping('_3')},addFault:function(g){var h=JS.DOM.li({className:'fault'},function(f){f.p(function(a){var b=g.split(/[\r\n]+/);b.splice(1,1);for(var c=0,d=b.length;c<d;c++){if(c>0)a.br();a.concat(b[c])}})});this._P.appendChild(h);this.ping('_a');this.fail()},getName:function(){var a=[],b=this._7&&this._7.getName&&this._7.getName();if(b)a.push(b);a.push(this._b);return a.join(' ')},runTest:function(){window.location.search='test='+encodeURIComponent(this.getName())},ping:function(a){if(!this[a])return;this[a].innerHTML=parseInt(this[a].innerHTML)+1;if(this._7.ping)this._7.ping(a)},fail:function(){if(!this._r)return;JS.DOM.removeClass(this._r,'passed');JS.DOM.addClass(this._s,'failed');if(this._7.fail)this._7.fail()}})},initialize:function(){this._Q();document.body.insertBefore(this._1q,document.body.firstChild)},_Q:function(){var f=this;f._1q=JS.DOM.div({className:'test-result-container'},function(d){d.table({className:'report'},function(c){c.thead(function(b){b.tr(function(a){a.th({scope:'col'},'Tests');a.th({scope:'col'},'Assertions');a.th({scope:'col'},'Failures');a.th({scope:'col'},'Errors')})});c.tbody(function(b){b.tr(function(a){f._3=a.td();f._1r=a.td();f._a=a.td();f._m=a.td()})})});f._18=d.div({className:'light light-pending'});d.p({className:'user-agent'},window.navigator.userAgent);f._1s=new f.klass.Context('spec',d.ul({className:'specs'}));f._1t=d.p({className:'summary'})})},setTestCount:function(a){this._3.innerHTML=String(a)},setAssertionCount:function(a){this._1r.innerHTML=String(a)},setFailureCount:function(a){this._a.innerHTML=String(a)},setErrorCount:function(a){this._m.innerHTML=String(a)},addTestCase:function(a){var b=this._19(a),c=b.name,d=b.context;d.addTest(c)},finishTestCase:function(a){},addFault:function(a,b){var c=this._19(a),d=c.name,f=c.context;f.child(d).addFault(b.longDisplay());this._1u=true},printSummary:function(a){JS.DOM.removeClass(this._18,'light-pending');JS.DOM.addClass(this._18,this._1u?'light-failed':'light-passed');this._1t.innerHTML='Finished in '+a+' seconds'},_19:function(c){var d=c.name(),f=c.klass,g=f.getContextName?f.getContextName():f.displayName,h=new JS.Enumerable.Collection();d=d.replace(g,'').replace(g,'').replace(/\(.*?\)$/g,'').replace(/^test\W+/g,'');while(f!==JS.Test.Unit.TestCase){h.push(f);f=f.superclass}g=h.reverseForEach().inject(this._1s,function(a,b){return a.child(b._u||b.displayName)});return{name:d,context:g}}})});JS.Test.Unit.extend({AutoRunner:new JS.Class({extend:{run:function(c){var d=this.getRunner(),f=d.getFilter(),g=[],h=[];JS.Test.Unit.TestCase.resolve();JS.Test.Unit.TestCase.forEach(function(a){var b=a.suite(f);if(b.size()>0)h.push(b);if(a.superclass===JS.Test.Unit.TestCase)g.push(a.displayName)});var i=new JS.Test.Unit.TestSuite(g.join(', '));for(var j=0,k=h.length;j<k;j++)i.push(h[j]);JS.Test.Unit.TestCase.clear();return d.run(i,this.OUTPUT_LEVELS[c||'normal'])},filter:function(a,b){var c=this.getRunner().getFilter(),d=[],f=c.length,g,h;if(f===0)return a;while(f--){g=a.length;while(g--){h=a[g].replace(new RegExp(b+'$'),'');if(c[f].substr(0,h.length)===h)d.push(a[g])}}return d},getRunner:function(){return(typeof window!=='undefined')?this.RUNNERS.browser:this.RUNNERS.console},RUNNERS:{console:JS.Test.Unit.UI.Console.TestRunner,browser:JS.Test.Unit.UI.Browser.TestRunner},OUTPUT_LEVELS:{silent:JS.Test.Unit.UI.SILENT,progress:JS.Test.Unit.UI.PROGRESS_ONLY,normal:JS.Test.Unit.UI.NORMAL,verbose:JS.Test.Unit.UI.VERBOSE}}})});JS.Test.extend({autorun:JS.Test.Unit.AutoRunner.method('run')});JS.Test.extend({Context:new JS.Module({extend:{included:function(a){a.extend(JS.Test.Context.Context,{_g:false});a.include(JS.Test.Context.LifeCycle,{_g:false});a.extend(JS.Test.Context.Test,{_g:false});a.include(JS.Console)},Context:new JS.Module({getContextName:function(){this._u=this._u||'';return(typeof this.superclass.getContextName==='function')?(this.superclass.getContextName()+' '+this._u).replace(/^\s+/,''):this.displayName},setContextName:function(a){this._u=a},context:function(a,b){var c=new JS.Class(this,{},{_g:false});c.__eigen__().resolve();c.setContextName(a.toString());c.setName(c.getContextName());b.call(c);return c},cover:function(a){var b=new JS.Test.Coverage(a);this.before_all_callbacks.push(b.method('attach'));this.after_all_callbacks.push(b.method('detach'));JS.Test.Unit.TestCase.reports.push(b)}})}}),describe:function(a,b){var c=new JS.Class(a.toString(),JS.Test.Unit.TestCase,{},{_g:false});c.include(JS.Test.Context,{_g:false});c.__eigen__().resolve();b.call(c);return c}});JS.Test.Context.Context.alias({describe:'context'});JS.Test.extend({context:JS.Test.describe});JS.Test.Context.LifeCycle=new JS.Module({extend:{included:function(b){b.extend(this.ClassMethods);b.before_all_callbacks=[];b.before_each_callbacks=[];b.after_all_callbacks=[];b.after_each_callbacks=[];b.before_should_callbacks={};b.extend({inherited:function(a){this.callSuper();a.before_all_callbacks=[];a.before_each_callbacks=[];a.after_all_callbacks=[];a.after_each_callbacks=[];a.before_should_callbacks={}}})},ClassMethods:new JS.Module({before:function(a,b){if((typeof a==='function')||!b){b=a;a='each'}this['before_'+(a+'_')+'callbacks'].push(b)},after:function(a,b){if((typeof a==='function')||!b){b=a;a='each'}this['after_'+(a+'_')+'callbacks'].push(b)},gatherCallbacks:function(a,b){var c=(typeof this.superclass.gatherCallbacks==='function')?this.superclass.gatherCallbacks(a,b):[];var d=this[a+'_'+(b+'_')+'callbacks'];return(a==='before')?c.concat(d):d.concat(c)}})},setup:function(a){var b=this;this.callSuper(function(){if(b.klass.before_should_callbacks[b._1])b.klass.before_should_callbacks[b._1].call(b);b.runCallbacks('before','each',a)})},teardown:function(a){var b=this;this.callSuper(function(){b.runCallbacks('after','each',a)})},runCallbacks:function(c,d,f){var g=this.klass.gatherCallbacks(c,d);JS.Test.Unit.TestSuite.forEach(g,function(a,b){this.exec(a,b)},f,this)},runAllCallbacks:function(d,f,g){var h=this.instanceVariables();this.runCallbacks(d,'all',function(){var c=this.instanceVariables().inject({},function(a,b){if(h.member(b))return a;a[b]=this[b];return a},this);if(f)f.call(g||null,c)})},setValuesFromCallbacks:function(a){for(var b in a)this[b]=a[b]},instanceVariables:function(){var a=[];for(var b in this){if(this.hasOwnProperty(b))a.push(b)}return new JS.Enumerable.Collection(a)}});(function(){var a=JS.Test.Context.LifeCycle.ClassMethods.method('instanceMethod');JS.Test.Context.LifeCycle.ClassMethods.include({setup:a('before'),teardown:a('after')})})();JS.Test.Context.extend({SharedBehavior:new JS.Class(JS.Module,{extend:{createFromBehavior:function(a){var b=new this();b._1v=a;return b},moduleName:function(c){return c.toLowerCase().replace(/[\s:',\.~;!#=\(\)&]+/g,'_').replace(/\/(.?)/g,function(a,b){return'.'+b.toUpperCase()}).replace(/(?:^|_)(.)/g,function(a,b){return b.toUpperCase()})}},included:function(a){this._1v.call(a)}})});JS.Test.Unit.TestCase.extend({shared:function(a,b){a=JS.Test.Context.SharedBehavior.moduleName(a);JS.ENV[a]=JS.Test.Context.SharedBehavior.createFromBehavior(b)},use:function(a){if(JS.isType(a,JS.Test.Context.SharedBehavior)||JS.isType(a,JS.Module))this.include(a);else if(JS.isType(a,'string')){var b=JS.Test.Context.SharedBehavior.moduleName(a),c=JS.ENV[b];if(!c)throw new Error('Could not find example group named "'+a+'"');this.include(c)}}});(function(){var g=function(a,b){var c={};for(var d=0,f=b.length;d<f;d++)c[b[d]]=JS.Test.Unit.TestCase[a];JS.Test.Unit.TestCase.extend(c)};g('shared',['sharedBehavior','shareAs','shareBehaviorAs','sharedExamplesFor']);g('use',['uses','itShouldBehaveLike','behavesLike','usesExamplesFrom'])})();JS.Test.Context.Test=new JS.Module({test:function(a,b,c){var d='test:',f=this.getContextName();if(f)d+=' '+f;d+=' '+a;if(this.instanceMethod(d))throw new Error(d+' is already defined in '+this.displayName);b=b||{};if(typeof b==='function'){c=b}else{if(b.before!==undefined)this.before_should_callbacks[d]=b.before}this.define(d,c,{_g:false})},beforeTest:function(a,b){this.test(a,{before:b},function(){})}});JS.Test.Context.Test.alias({it:'test',should:'test',tests:'test',beforeIt:'beforeTest',beforeShould:'beforeTest',beforeTests:'beforeTest'});(function(){var b=JS.Test.Unit.TestCase.suite;JS.Test.Unit.TestCase.extend({suite:function(a){return b.call(this,a,false,false)}})})();JS.Test.Unit.TestSuite.include({run:function(d,f,g,h){g.call(h||null,this.klass.STARTED,this._b);var i=function(c){this.forEach(function(a,b){if(c)a.setValuesFromCallbacks(c);a.run(d,b,g,h)},function(){var a=function(){g.call(h||null,this.klass.FINISHED,this._b);f()};if(c)j.runAllCallbacks('after',a,this);else a.call(this)},this)};var j=this._3[0],k=null;if(j&&j.runAllCallbacks)j.runAllCallbacks('before',i,this);else i.call(this,null)}});JS.Test.extend({Mocking:new JS.Module({extend:{ExpectationError:new JS.Class(JS.Test.Unit.AssertionFailedError),UnexpectedCallError:new JS.Class(Error,{initialize:function(a){this.message=a.toString()}}),__activeStubs__:[],stub:function(a,b,c){var d=false;if(a==='new'){a=b;b=c;c=undefined;d=true}if(JS.isType(a,'string')){c=b;b=a;a=JS.ENV}var f=this.__activeStubs__,g=f.length;while(g--){if(f[g]._d===a&&f[g]._1===b)return f[g].defaultMatcher(c)}var h=new JS.Test.Mocking.Stub(a,b,d);f.push(h);return h.defaultMatcher(c)},removeStubs:function(){var a=this.__activeStubs__,b=a.length;while(b--)a[b].revoke();this.__activeStubs__=[]},verify:function(){try{var a=this.__activeStubs__;for(var b=0,c=a.length;b<c;b++)a[b]._1w()}finally{this.removeStubs()}},Stub:new JS.Class({initialize:function(a,b,c){this._d=a;this._1=b;this._v=c;this._h=a[b];this._1x=a.hasOwnProperty?a.hasOwnProperty(b):(typeof this._h!=='undefined');var d=JS.Test.Mocking;this._w=[];this._i=new d.Parameters([new d.AnyArgs()]);this._9=false;this.apply()},defaultMatcher:function(a){if(a!==undefined&&typeof a!=='function'){this._d[this._1]=a;return this}this._1a();this._4=this._i;if(typeof a==='function')this._4._1b=a;return this},apply:function(){var a=this._d,b=this._1;if(a[b]!==this._h)return;var c=this;this._1c=function(){return c._1y(this,arguments)};a[b]=this._1c},revoke:function(){if(this._1x)this._d[this._1]=this._h;else try{delete this._d[this._1]}catch(e){this._d[this._1]=undefined}},expected:function(){this._9=true;this._i._9=true},_1a:function(){if(this._4)this._4._1d=true},_1y:function(a,b){this._1a();var c=this._w.concat(this._i),d,f,g;if(this._v&&!(a instanceof this._1c)){g=new JS.Test.Unit.AssertionMessage('','<?> expected to be a constructor but called without `new`',[this._h]);throw new JS.Test.Mocking.UnexpectedCallError(g);}this._i.ping();for(var h=0,i=c.length;h<i;h++){d=c[h];f=d.match(b);if(!f)continue;if(d!==this._i)d.ping();if(f.fake)return f.fake.apply(a,b);if(f.exception)throw f.exception;if(f.hasOwnProperty('callback')){if(!f.callback)continue;f.callback.apply(f.context,d.nextYieldArgs())}if(f)return d.nextReturnValue()}if(this._v){g=new JS.Test.Unit.AssertionMessage('','<?> constructed with unexpected arguments:\n(?)',[this._h,JS.array(b)])}else{g=new JS.Test.Unit.AssertionMessage('','<?> received call to '+this._1+'() with unexpected arguments:\n(?)',[a,JS.array(b)])}throw new JS.Test.Mocking.UnexpectedCallError(g);},_1w:function(){if(!this._9)return;for(var a=0,b=this._w.length;a<b;a++)this._1e(this._w[a]);this._1e(this._i)},_1e:function(a){var b=this._v?this._h:this._d;a.verify(b,this._1,this._v)}})}})});JS.Test.Mocking.extend({Parameters:new JS.Class({initialize:function(a,b){this._1f=JS.array(a);this._9=b;this._1d=false;this._j=0},toArray:function(){var a=this._1f.slice();if(this._k)a.push(new JS.Test.Mocking.InstanceOf(Function));return a},returns:function(a){this._R=0;this._S=a},nextReturnValue:function(){if(!this._S)return undefined;var a=this._S[this._R];this._R=(this._R+1)%this._S.length;return a},yields:function(a){this._T=0;this._k=a},nextYieldArgs:function(){if(!this._k)return undefined;var a=this._k[this._T];this._T=(this._T+1)%this._k.length;return a},setMinimum:function(a){this._9=true;this._U=a},setMaximum:function(a){this._9=true;this._x=a},setExpected:function(a){this._9=true;this._y=a},match:function(a){if(!this._1d)return false;var b=JS.array(a),c,d;if(this._k){if(typeof b[b.length-2]==='function'){d=b.pop();c=b.pop()}else if(typeof b[b.length-1]==='function'){d=null;c=b.pop()}}if(!JS.Enumerable.areEqual(this._1f,b))return false;var f={};if(this._f){f.exception=this._f}if(this._k){f.callback=c;f.context=d}if(this._1b){f.fake=this._1b}return f},ping:function(){this._j+=1},verify:function(a,b,c){if(!this._9)return;var d=true,f;if(this._j===0&&this._x===undefined&&this._y===undefined){d=false}else if(this._y!==undefined&&this._j!==this._y){f=this._V('exactly');d=false}else if(this._x!==undefined&&this._j>this._x){f=this._V('at most');d=false}else if(this._U!==undefined&&this._j<this._U){f=this._V('at least');d=false}if(d)return;var g;if(c){g=new JS.Test.Unit.AssertionMessage('Mock expectation not met','<?> expected to be constructed with\n(?)'+(f?'\n'+f:''),[a,this.toArray()])}else{g=new JS.Test.Unit.AssertionMessage('Mock expectation not met','<?> expected to receive call\n'+b+'(?)'+(f?'\n'+f:''),[a,this.toArray()])}throw new JS.Test.Mocking.ExpectationError(g);},_V:function(a){var b=this._j,c='but '+b+' call'+(b===1?' was':'s were')+' made';var d={'exactly':this._y,'at most':this._x,'at least':this._U};return a+' '+d[a]+' times\n'+c}})});JS.Test.Mocking.extend({Anything:new JS.Class({equals:function(){return true},toString:function(){return'anything'}}),AnyArgs:new JS.Class({equals:function(){return JS.Enumerable.ALL_EQUAL},toString:function(){return'*arguments'}}),ArrayIncluding:new JS.Class({initialize:function(a){this._e=Array.prototype.slice.call(a)},equals:function(a){if(!JS.isType(a,Array))return false;var b=this._e.length,c;loop:while(b--){c=a.length;while(c--){if(JS.Enumerable.areEqual(this._e[b],a[c]))continue loop}return false}return true},toString:function(){var a=JS.Console.convert(this._e);return'arrayIncluding('+a+')'}}),ObjectIncluding:new JS.Class({initialize:function(a){this._e=a},equals:function(a){if(!JS.isType(a,Object))return false;for(var b in this._e){if(!JS.Enumerable.areEqual(this._e[b],a[b]))return false}return true},toString:function(){var a=JS.Console.convert(this._e);return'objectIncluding('+a+')'}}),InstanceOf:new JS.Class({initialize:function(a){this._8=a},equals:function(a){return JS.isType(a,this._8)},toString:function(){var a=JS.Console.convert(this._8),b=/^[aeiou]/i.test(a)?'an':'a';return b+'('+a+')'}}),Matcher:new JS.Class({initialize:function(a){this._8=a},equals:function(a){return JS.match(this._8,a)},toString:function(){var a=JS.Console.convert(this._8);return'matching('+a+')'}})});JS.Test.Mocking.Stub.include({given:function(){var a=new JS.Test.Mocking.Parameters(arguments,this._9);this._w.push(a);this._4=a;return this},raises:function(a){this._4._f=a;return this},returns:function(){this._4.returns(arguments);return this},yields:function(){this._4.yields(arguments);return this},atLeast:function(a){this._4.setMinimum(a);return this},atMost:function(a){this._4.setMaximum(a);return this},exactly:function(a){this._4.setExpected(a);return this}});JS.Test.Mocking.Stub.alias({raising:'raises',returning:'returns',yielding:'yields'});JS.Test.Mocking.extend({DSL:new JS.Module({stub:function(){return JS.Test.Mocking.stub.apply(JS.Test.Mocking,arguments)},expect:function(){var a=JS.Test.Mocking.stub.apply(JS.Test.Mocking,arguments);a.expected();this.addAssertion();return a},anything:function(){return new JS.Test.Mocking.Anything()},anyArgs:function(){return new JS.Test.Mocking.AnyArgs()},instanceOf:function(a){return new JS.Test.Mocking.InstanceOf(a)},match:function(a){return new JS.Test.Mocking.Matcher(a)},arrayIncluding:function(){return new JS.Test.Mocking.ArrayIncluding(arguments)},objectIncluding:function(a){return new JS.Test.Mocking.ObjectIncluding(a)}})});JS.Test.Unit.TestCase.include(JS.Test.Mocking.DSL);JS.Test.Unit.mocking=JS.Test.Mocking;JS.Test.extend({FakeClock:new JS.Module({extend:{API:new JS.Singleton({stub:function(){var a=JS.Test.Mocking,b=['Date','setTimeout','clearTimeout','setInterval','clearInterval'],c=b.length;JS.Test.FakeClock.reset();while(c--)a.stub(b[c],JS.Test.FakeClock.method(b[c]))},reset:function(){return JS.Test.FakeClock.reset()},tick:function(a){return JS.Test.FakeClock.tick(a)}}),JSDate:Date,Schedule:new JS.Class(JS.SortedSet,{nextScheduledAt:function(b){return this.find(function(a){return a.time<=b})}}),Timeout:new JS.Class({include:JS.Comparable,initialize:function(a,b,c){this.callback=a;this.interval=b;this.repeat=c},compareTo:function(a){return this.time-a.time},toString:function(){return(this.repeat?'Interval':'Timeout')+'('+this.interval+'):'+this.time}}),reset:function(){this._z=new Date().getTime();this._A=this._z;this._o=new this.Schedule()},tick:function(a){this._z+=a;var b;while(b=this._o.nextScheduledAt(this._z))this._1z(b);this._A=this._z},_1z:function(a){this._A=a.time;a.callback();if(a.repeat){a.time+=a.interval;this._o.rebuild()}else{this.clearTimeout(a)}},_1g:function(a,b,c){var d=new this.Timeout(a,b,c);d.time=this._A+b;this._o.add(d);return d},Date:function(){var a=new this.JSDate();a.setTime(this._A);return a},setTimeout:function(a,b){return this._1g(a,b,false)},setInterval:function(a,b){return this._1g(a,b,true)},clearTimeout:function(a){this._o.remove(a)},clearInterval:function(a){this._o.remove(a)}}})});JS.Test.FakeClock.include({clock:JS.Test.FakeClock.API});JS.Test.extend({AsyncSteps:new JS.Class(JS.Module,{define:function(b,c){this.callSuper(b,function(){var a=[b,c].concat(JS.array(arguments));this.__enqueue__(a)})},included:function(d){d.include(JS.Test.AsyncSteps.Sync);if(!d.includes(JS.Test.Context))return;d.after(function(a){this.sync(a)});d.extend({after:function(b,c){if((typeof b==='function')||!c){c=b;b='each'}this.callSuper(function(a){this.sync(function(){this.exec(c,a)})})}})},extend:{Sync:new JS.Module({__enqueue__:function(a){this.__stepQueue__=this.__stepQueue__||[];this.__stepQueue__.push(a);if(this.__runningSteps__)return;this.__runningSteps__=true;var b=JS.Test.Unit.TestSuite.setTimeout;b(this.method('__runNextStep__'),1)},__runNextStep__:function(){var a=this.__stepQueue__.shift(),b;if(!a){this.__runningSteps__=false;if(!this.__stepCallbacks__)return;b=this.__stepCallbacks__.length;while(b--)this.__stepCallbacks__.shift().call(this);return}var c=a.shift(),d=a.shift(),f=a.slice(),g=function(){d.apply(this,f)};f[d.length-1]=this.method('__runNextStep__');if(!this.exec)return g.call(this);this.exec(g,function(){},this.method('__endSteps__'))},__endSteps__:function(){this.__stepQueue__=[];this.__runNextStep__()},addError:function(){this.callSuper();this.__endSteps__()},sync:function(a){if(!this.__runningSteps__)return a.call(this);this.__stepCallbacks__=this.__stepCallbacks__||[];this.__stepCallbacks__.push(a)}})}}),asyncSteps:function(a){return new this.AsyncSteps(a)}});JS.Test.extend({Coverage:new JS.Class({initialize:function(d){this._1h=d;this._B=new JS.Hash([]);var f=function(a){var b=a.instanceMethods(false),c=b.length;while(c--)this._B.store(a.instanceMethod(b[c]),0)};f.call(this,d);f.call(this,d.__eigen__())},attach:function(){var a=this._1h;JS.StackTrace.addObserver(this);JS.Method.trace([a,a.__eigen__()])},detach:function(){var a=this._1h;JS.Method.untrace([a,a.__eigen__()]);JS.StackTrace.removeObserver(this)},update:function(a,b){if(a!=='call')return;var c=this._B.assoc(b.method);if(c)c.setValue(c.value+1)},report:function(){var c=this._B.entries().sort(function(a,b){return b.value-a.value});var d=this._B.all(function(a){return a.value>0});JS.Console.printTable(c,function(a,b){if(a[1]===0)return['bgred','white'];return(b%2===0)?['bold']:[]});return d}})});JS.Test.extend({Helpers:new JS.Module({$R:function(a,b){return new JS.Range(a,b)},$w:function(a){return a.split(/\s+/)},forEach:function(a,b,c){for(var d=0,f=a.length;d<f;d++){b.call(c||null,a[d],d)}},its:function(){return new JS.MethodChain()},map:function(a,b,c){return new JS.Enumerable.Collection(a).map(b,c)},repeat:function(a,b,c){while(a--)b.call(c)}})});
//@ sourceMappingURL=test.js.map