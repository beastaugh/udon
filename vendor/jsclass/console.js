JS.Console=new JS.Module('Console',{extend:{nameOf:function(a,b){var d=[],e,j,c,f;if(JS.isType(a,Array)){for(e=0,j=a.length;e<j;e++)d.push(this.nameOf(a[e]));return d}if(a.displayName)return a.displayName;c=[{name:null,o:b||JS.ENV}];f=0;while(typeof c==='object'&&f<this.MAX_DEPTH){f+=1;c=this.descend(c,a)}if(typeof c=='string'){c=c.replace(/\.prototype\./g,'#');a.displayName=c;if(a.__meta__)a.__meta__.displayName=c+'.__meta__'}return a.displayName},descend:function(a,b){var d=[],e=a.length,j=e,c,f,g;while(j--){f=a[j];if(JS.isType(f.o,Array))continue;g=f.name?f.name+'.':'';for(c in f.o){if(b&&f.o[c]===b)return g+c;d.push({name:g+c,o:f.o[c]})}}return d},MAX_DEPTH:4,convert:function(b,d){var e=JS.Enumerable;if(!b)return String(b);if(b instanceof Error){return(typeof b.message==='string'&&!b.message)?b.name:b.name+(b.message?': '+b.message:'')}if(b instanceof Array)return'['+new e.Collection(b).map(function(item){return this.convert(item)},this).join(',')+']';if(b instanceof String||typeof b==='string')return'"'+b+'"';if(b instanceof Function)return b.displayName||b.name||(b.toString().match(/^\s*function ([^\(]+)\(/)||[])[1]||'#function';if(b.toString&&b.toString!==Object.prototype.toString&&!b.toString.__traced__)return b.toString();return'{'+new e.Collection(e.objectKeys(b,false).sort()).map(function(a){return this.convert(a)+':'+this.convert(b[a])},this).join(',')+'}'},ANSI_CSI:String.fromCharCode(0x1B)+'[',MAX_BUFFER_LENGTH:78,BROWSER:(typeof window!=='undefined'),NODE:(typeof process==='object'),WINDOZE:(typeof window!=='undefined'||typeof WScript!=='undefined'),coloring:function(){return!(this.BROWSER&&!window.runtime)&&!this.WINDOZE},__buffer__:'',__format__:'',ESCAPE_CODES:{reset:0,bold:1,normal:22,underline:4,noline:24,blink:5,noblink:25,black:30,bgblack:40,red:31,bgred:41,green:32,bggreen:42,yellow:33,bgyellow:43,blue:34,bgblue:44,magenta:35,bgmagenta:45,cyan:36,bgcyan:46,white:37,bgwhite:47,nocolor:39,bgnocolor:49},escape:function(a){return this.ANSI_CSI+a},repeat:function(a,b){var d='';while(b--)d+=a;return d},pad:function(a,b){a=(a===undefined?'':a).toString();return a+this.repeat(' ',b-a.length)},flushFormat:function(){var a=this.__format__;this.__format__='';return a},output:function(a,b){while(a.length>0){var d=this.__buffer__.length,e=this.BROWSER?1000:this.MAX_BUFFER_LENGTH,j=(d>0&&this.coloring()),c=j?this.escape('1F')+this.escape((d+1)+'G'):'',f=a.substr(0,e-d);this.__buffer__+=f;if(this.coloring())this.writeToStdout(c+this.flushFormat()+f);else if(this.__buffer__.length===e)this.writeToStdout(this.__buffer__);if(this.__buffer__.length===e)this.__buffer__='';a=a.substr(e-d)}if(!b){if(a===''&&!this.__buffer__)this.writeToStdout(this.flushFormat()+'');if(!this.coloring()&&this.__buffer__)this.writeToStdout(this.__buffer__);this.__buffer__=''}},writeToStdout:function(a){if(this.BROWSER&&window.runtime)return window.runtime.trace(a);if(typeof console!=='undefined')return console.log(a);if(typeof alert==='function')return alert(a);if(typeof process==='object')return require('util').puts(a);if(typeof WScript!=='undefined')return WScript.Echo(a);if(typeof print==='function')return print(a)}},consoleFormat:function(){if(!JS.Console.coloring())return;this.reset();var a=arguments.length;while(a--)this[arguments[a]]()},puts:function(a){a=(a===undefined?'':a).toString();var b=JS.Console;if(!b.NODE)return b.output(a,false);require('util').puts(b.flushFormat()+a);b.__print__=false},print:function(a){a=(a===undefined?'':a).toString();var b=JS.Console;if(!b.NODE)return b.output(a,true);require('util').print(b.flushFormat()+a);b.__print__=true},printTable:function(c,f){var g=[],c=[['Method','Calls']].concat(c),l=JS.Console,i=c.length,h,m;while(i--){h=c[i].length;while(h--){g[h]=g[h]||0;m=(c[i][h]===undefined?'':c[i][h]).toString();g[h]=Math.max(m.length,g[h])}}var k='+',h=g.length;while(h--)k='+'+l.repeat('-',g[h]+2)+k;k='  '+k;this.reset();this.puts();this.puts(k);var n=function(a,b){var d=c[a];this.reset();this.print('  ');for(var e=0,j=d.length;e<j;e++){this.reset();this.print('|');this.consoleFormat.apply(this,b);this.print(' '+l.pad(d[e],g[e])+' ')}this.reset();this.puts('|')};n.call(this,0,['bold']);this.reset();this.puts(k);for(var i=1,o=c.length;i<o;i++){var p=f?f(c[i],i):[];n.call(this,i,p)}this.reset();this.puts(k)}});(function(){var d=JS.Console;for(var e in d.ESCAPE_CODES)(function(b){d.define(b,function(){if(!JS.Console.coloring())return;var a=d.ESCAPE_CODES[b];d.__format__+=d.escape(a+'m')})})(e);d.extend(d)})();